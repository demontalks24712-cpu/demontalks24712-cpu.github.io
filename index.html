<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vault Pro Messenger</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    :root { --wa-teal: #075e54; --wa-green: #25d366; --wa-light-green: #dcf8c6; }
    body { margin: 0; background: #000; font-family: -apple-system, sans-serif; overflow: hidden; }
    
    /* Calculator */
    .calc-btn { height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; transition: all 0.2s; cursor: pointer; }
    .calc-btn:active { transform: scale(0.9); filter: brightness(1.5); }
    
    /* WhatsApp Styles */
    .wa-bg { background-color: #efeae2; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); }
    .bubble { position: relative; max-width: 80%; padding: 8px 12px; border-radius: 12px; font-size: 15px; box-shadow: 0 1px 1px rgba(0,0,0,0.1); cursor: pointer; }
    .bubble.sent { background: var(--wa-light-green); align-self: flex-end; border-top-right-radius: 2px; }
    .bubble.received { background: #fff; align-self: flex-start; border-top-left-radius: 2px; }
    .status-ring { border: 2.5px solid #25d366; padding: 2px; border-radius: 50%; }
    .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

const firebaseConfig = {
  apiKey: "AIzaSyAqzixsAPq3_raCrISBh8DO8hlg_caobRg",
  authDomain: "calc1808-77d23.firebaseapp.com",
  databaseURL: "https://calc1808-77d23-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "calc1808-77d23",
  storageBucket: "calc1808-77d23.firebasestorage.app",
  messagingSenderId: "583746114466",
  appId: "1:583746114466:web:19379c33bae85986de58fb"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const App = () => {
  const [view, setView] = useState('calculator'); // calculator, auth, contacts, chat, status, profile
  const [display, setDisplay] = useState('0');
  const [currentUser, setCurrentUser] = useState(null);
  const [users, setUsers] = useState([]);
  const [activeChat, setActiveChat] = useState({ id: 'global', name: 'Global Lounge' });
  const [messages, setMessages] = useState([]);
  const [statuses, setStatuses] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [msgInput, setMsgInput] = useState('');
  const [authForm, setAuthForm] = useState({ user: '', pass: '', isSignup: false });
  const messagesEndRef = useRef(null);

  const SECRET_CODE = '17071808';
  const CLEAR_CHAT_CODE = '180809';
  const DELETE_USER_CODE = '170709';
  const DELETE_STATUS_CODE = '130709';

  useEffect(() => {
    const saved = localStorage.getItem('v_user');
    if (saved) setCurrentUser(JSON.parse(saved));
    db.ref('users').on('value', s => setUsers(s.val() ? Object.keys(s.val()) : []));
    db.ref('status').on('value', s => {
      const data = s.val();
      setStatuses(data ? Object.entries(data).map(([key, val]) => ({ ...val, key })) : []);
    });
  }, []);

  useEffect(() => {
    if (view === 'chat') {
      const chatRef = db.ref(`chats/${activeChat.id}`);
      chatRef.on('value', s => {
        const data = s.val();
        setMessages(data ? Object.entries(data).map(([key, val]) => ({ ...val, key })) : []);
      });
      return () => chatRef.off();
    }
  }, [view, activeChat]);

  useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

  const handleCalc = (val) => {
    if (val === 'AC') return setDisplay('0');
    if (val === '=') {
      if (display === SECRET_CODE) setView(currentUser ? 'contacts' : 'auth');
      else {
        try { setDisplay(String(eval(display.replace(/×/g,'*').replace(/÷/g,'/')))); } 
        catch { setDisplay('Error'); }
      }
      return;
    }
    setDisplay(p => p === '0' ? val : p + val);
  };

  const handleAuth = () => {
    if (!authForm.user || !authForm.pass) return alert("Fill all fields");
    const uRef = db.ref(`users/${authForm.user}`);
    if (authForm.isSignup) {
      uRef.set({ pass: authForm.pass }); login(authForm.user);
    } else {
      uRef.once('value', s => {
        if (s.val()?.pass === authForm.pass) login(authForm.user);
        else alert("Wrong Credentials");
      });
    }
  };

  const login = (name) => {
    const user = { name };
    setCurrentUser(user);
    localStorage.setItem('v_user', JSON.stringify(user));
    setView('contacts');
  };

  const removeUser = (uName) => {
    if (prompt("Enter Code to Delete User:") === DELETE_USER_CODE) {
      db.ref(`users/${uName}`).remove();
    }
  };

  const removeStatus = (sKey) => {
    if (prompt("Enter Code to Delete Status:") === DELETE_STATUS_CODE) {
      db.ref(`status/${sKey}`).remove();
    }
  };

  const deleteMessage = (mKey, sender) => {
    const act = prompt("1: Delete for Me\n2: Delete for Everyone");
    if (act === '2' && sender === currentUser.name) db.ref(`chats/${activeChat.id}/${mKey}`).remove();
    else if (act === '1') alert("Removed locally");
  };

  const postStatus = () => {
    const txt = prompt("What's on your mind?");
    if (txt) db.ref('status').push({ user: currentUser.name, text: txt, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) });
  };

  const sendMessage = () => {
    if (!msgInput.trim()) return;
    db.ref(`chats/${activeChat.id}`).push({ sender: currentUser.name, text: msgInput, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) });
    setMsgInput('');
  };

  if (view === 'calculator') return (
    <div className="h-screen flex flex-col p-8 max-w-md mx-auto justify-end">
      <div className="text-right text-7xl font-light text-white mb-10 overflow-hidden">{display}</div>
      <div className="grid grid-cols-4 gap-4">
        {['AC','+/-','%','÷','7','8','9','×','4','5','6','-','1','2','3','+'].map(b => (
          <button key={b} onClick={()=>handleCalc(b)} className={`calc-btn ${isNaN(b)&&b!=='.'?'bg-orange-500':'bg-zinc-800 text-white'}`}>{b}</button>
        ))}
        <button onClick={()=>handleCalc('0')} className="calc-btn bg-zinc-800 text-white col-span-2 rounded-full px-8 justify-start">0</button>
        <button onClick={()=>handleCalc('.')} className="calc-btn bg-zinc-800 text-white">.</button>
        <button onClick={()=>handleCalc('=')} className="calc-btn bg-orange-500 text-white">=</button>
      </div>
    </div>
  );

  if (view === 'auth') return (
    <div className="h-screen flex items-center justify-center p-6 bg-zinc-950">
      <div className="glass w-full p-10 rounded-[40px] text-center text-white">
        <h2 className="text-3xl font-bold mb-8">{authForm.isSignup ? 'Create Profile' : 'Vault Login'}</h2>
        <input className="w-full bg-white/5 p-4 rounded-2xl mb-4 border border-white/10 outline-none" placeholder="Username" onChange={e=>setAuthForm({...authForm, user: e.target.value})} />
        <input type="password" className="w-full bg-white/5 p-4 rounded-2xl mb-8 border border-white/10 outline-none" placeholder="Password" onChange={e=>setAuthForm({...authForm, pass: e.target.value})} />
        <button onClick={handleAuth} className="w-full bg-blue-600 p-4 rounded-2xl font-bold">Access Messenger</button>
        <p className="mt-6 opacity-50 text-sm" onClick={()=>setAuthForm({...authForm, isSignup: !authForm.isSignup})}>{authForm.isSignup?'Already a member? Login':'New? Sign up'}</p>
      </div>
    </div>
  );

  if (view === 'contacts') return (
    <div className="h-screen flex flex-col bg-white">
      <div className="bg-[#075e54] pt-12 pb-4 px-6 text-white shadow-xl">
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-2xl font-bold">Mini Whatsapp</h1>
          <div className="flex gap-6">
            <button onClick={()=>setView('status')}>STATUS</button>
            <button onClick={()=>setView('profile')}>PROFILE</button>
          </div>
        </div>
        <div className="bg-white/10 flex items-center p-2 rounded-xl">
          <input className="bg-transparent flex-1 outline-none px-2 placeholder-white/50" placeholder="Search contacts..." onChange={e=>setSearchTerm(e.target.value)} />
        </div>
      </div>
      <div className="flex-1 overflow-y-auto">
        <div onClick={()=>{setActiveChat({id:'global',name:'Global Lounge'}); setView('chat');}} className="p-4 border-b flex items-center gap-4 active:bg-zinc-100 cursor-pointer">
          <div className="w-14 h-14 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">G</div>
          <div><p className="font-bold text-black">Global Lounge</p><p className="text-sm text-zinc-500 font-medium">Group chat for everyone</p></div>
        </div>
        {users.filter(u => u !== currentUser.name && u.toLowerCase().includes(searchTerm.toLowerCase())).map(u => (
          <div key={u} className="p-4 border-b flex items-center gap-4 active:bg-zinc-100 cursor-pointer">
            <div onClick={()=>{const id=[currentUser.name,u].sort().join('_'); setActiveChat({id, name:u}); setView('chat');}} className="flex-1 flex items-center gap-4">
              <div className="w-14 h-14 bg-zinc-200 rounded-full flex items-center justify-center text-zinc-600 font-bold">{u[0]}</div>
              <p className="font-bold text-black">{u}</p>
            </div>
            <button onClick={()=>removeUser(u)} className="p-2 text-red-500 opacity-20 hover:opacity-100">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg>
            </button>
          </div>
        ))}
      </div>
    </div>
  );

  if (view === 'status') return (
    <div className="h-screen flex flex-col bg-[#121b22] text-white">
      <div className="p-6 pt-12 flex items-center justify-between bg-[#1f2c34]">
        <button onClick={()=>setView('contacts')}>← Back</button>
        <h1 className="text-xl font-bold">Status</h1>
        <button onClick={postStatus} className="text-[#25d366]">ADD</button>
      </div>
      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        {statuses.map(s => (
          <div key={s.key} onClick={()=>removeStatus(s.key)} className="flex items-center gap-4 bg-white/5 p-4 rounded-2xl">
            <div className="w-12 h-12 status-ring flex items-center justify-center font-bold">{s.user[0]}</div>
            <div><p className="font-bold text-[#25d366]">{s.user}</p><p className="text-zinc-200">{s.text}</p><p className="text-[10px] opacity-40 mt-1 uppercase">{s.time}</p></div>
          </div>
        ))}
      </div>
    </div>
  );

  if (view === 'profile') return (
    <div className="h-screen bg-zinc-50 flex flex-col">
      <div className="p-6 pt-12 bg-[#075e54] text-white flex items-center gap-4">
        <button onClick={()=>setView('contacts')}>←</button><h1 className="text-xl font-bold">Profile</h1>
      </div>
      <div className="flex flex-col items-center pt-12">
        <div className="w-32 h-32 bg-zinc-200 rounded-full flex items-center justify-center text-5xl font-bold text-zinc-400 mb-6 shadow-xl">{currentUser.name[0]}</div>
        <h2 className="text-3xl font-bold text-black">{currentUser.name}</h2>
        <p className="text-zinc-500 mb-10">Available</p>
        <button onClick={()=>{localStorage.removeItem('v_user'); setCurrentUser(null); setView('calculator');}} className="w-4/5 bg-red-500 text-white p-4 rounded-2xl font-bold shadow-lg">LOGOUT AND LOCK</button>
      </div>
    </div>
  );

  return (
    <div className="h-screen flex flex-col wa-bg text-black">
      <div className="p-4 pt-12 bg-[#075e54] text-white flex items-center gap-4">
        <button onClick={()=>setView('contacts')} className="text-2xl pr-2">←</button>
        <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center font-bold">{activeChat.name[0]}</div>
        <div className="flex-1 font-bold">{activeChat.name}</div>
        <button onClick={()=>{if(prompt("Enter Clear Code:")===CLEAR_CHAT_CODE) db.ref(`chats/${activeChat.id}`).remove()}}><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6"/></svg></button>
      </div>
      <div className="flex-1 overflow-y-auto p-4 flex flex-col gap-2">
        {messages.map((m) => (
          <div key={m.key} onClick={()=>deleteMessage(m.key, m.sender)} className={`bubble ${m.sender === currentUser.name ? 'sent' : 'received'}`}>
            {activeChat.id === 'global' && m.sender !== currentUser.name && <p className="text-[10px] font-bold text-green-700 mb-1">{m.sender}</p>}
            <p className="pr-10 leading-snug">{m.text}</p><span className="text-[9px] opacity-40 absolute bottom-1 right-2 font-bold">{m.time}</span>
          </div>
        ))}
        <div ref={messagesEndRef} />
      </div>
      <div className="p-3 bg-[#f0f0f0] flex gap-3">
        <input className="flex-1 bg-white p-3 rounded-full outline-none shadow-inner" placeholder="Type a message..." value={msgInput} onChange={e=>setMsgInput(e.target.value)} onKeyPress={e=>e.key==='Enter' && sendMessage()} />
        <button onClick={sendMessage} className="bg-[#128c7e] w-12 h-12 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-all"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2.5"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg></button>
      </div>
    </div>
  );
};

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
